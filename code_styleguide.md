# Руководство по стилю кода

## Ключевые принципы

- Писать лаконичные, технические ответы с точными примерами Python.
- Использовать функциональное, декларативное программирование; избегать классов где возможно.
- Предпочитать итерации и модульность дублированию кода.
- Использовать описательные имена переменных с вспомогательными глаголами (например, is_active, has_permission).
- Использовать нижний регистр с подчеркиваниями для директорий и файлов (например, routers/user_routes.py).
- Отдавать предпочтение именованному экспорту для маршрутов и служебных функций.
- Использовать паттерн RORO (Получить Объект, Вернуть Объект).

## Python/FastAPI

- Использовать def для чистых функций и async def для асинхронных операций.
- Использовать типизацию для всех сигнатур функций. Предпочитать модели Pydantic словарям для валидации входных данных.
- Структура файла: экспортируемый роутер, под-маршруты, утилиты, статический контент, типы (модели, схемы).
- Избегать ненужных фигурных скобок в условных операторах.
- Для однострочных выражений в условных операторах опускать фигурные скобки.
- Использовать лаконичный однострочный синтаксис для простых условных выражений (например, if condition: do_something()).

## Обработка ошибок и валидация

### Приоритет обработки ошибок и крайних случаев:
- Обрабатывать ошибки и крайние случаи в начале функций.
- Использовать ранние возвраты для условий ошибок во избежание глубоко вложенных if.
- Размещать успешный путь выполнения последним в функции для улучшения читаемости.
- Избегать ненужных else; использовать паттерн if-return.
- Использовать guard clauses для обработки предусловий и недопустимых состояний.
- Реализовывать правильное логирование ошибок и понятные сообщения об ошибках.
- Использовать пользовательские типы ошибок или фабрики ошибок для согласованной обработки.

## Зависимости

- FastAPI
- Pydantic v2
- Асинхронные библиотеки для баз данных
- SQLAlchemy 2.0 (при использовании ORM)

## Специфические рекомендации FastAPI

- Использовать функциональные компоненты и модели Pydantic для валидации.
- Использовать декларативные определения маршрутов с четкими аннотациями возвращаемых типов.
- Использовать def для синхронных и async def для асинхронных операций.
- Минимизировать @app.on_event("startup") и @app.on_event("shutdown").
- Использовать middleware для логирования, мониторинга ошибок и оптимизации.
- Оптимизировать производительность используя async функции.
- Использовать HTTPException для ожидаемых ошибок.
- Использовать middleware для обработки неожиданных ошибок.
- Использовать Pydantic BaseModel для валидации.

## Оптимизация производительности

- Минимизировать блокирующие I/O операции.
- Оптимизировать сериализацию данных с Pydantic.
- Использовать ленивую загрузку для больших наборов данных.

## Ключевые конвенции

1. Использовать систему внедрения зависимостей FastAPI.
2. Приоритет метрикам производительности API.
3. Ограничить блокирующие операции в маршрутах:
   - Отдавать предпочтение асинхронным потокам.
   - Использовать выделенные async функции для операций с БД и внешними API.
   - Четко структурировать маршруты и зависимости.